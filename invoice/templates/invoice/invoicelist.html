{% extends "store/base.html" %}
{% load render_table from django_tables2 %}
{% load querystring from django_tables2 %}
{% load static %}
{%load add_filters%}
{% block title %}Invoices{% endblock title %}

{% block content %}
<div class="container px-5 p-4">
  <style>
    .table th, .table td {
        text-align: center;
    }
  </style>
 <div class="mb-2">
    <ul class=" pb-2 list-group list-group-horizontal w-25  gap-2">
        {%for i in weeks%}
        
        <a href="?month={{i.num}}"  class="list-group-item list-group-item-action py-2 rounded-small {%if request.GET.month == i.num|strf %} active {%endif%} {%if i.num == 1 and not request.GET.month%}active{%endif%}">{{i.month}}</a>
        {%endfor%}
    </ul>
    <ul id="week_day" class="pb-2 list-group list-group-horizontal w-75  gap-2">
        {%for ii in week|myrange%}
        <a href="?week={{ii.weekno}}&{{request|get_GET_week}}"  class="list-group-item list-group-item-action py-2 rounded-small {% if  ii.weekno == request.GET.week %} active {%endif%} {%if forloop.counter == 1  and not request.GET.week %}active{%endif%}">{{ii.dates}}</a>
        {%endfor%}
    </ul>
    <ul id="days" class="pb-2 list-group list-group-horizontal w-25  gap-2">
        {%for day in days%}
        <a href="?date={{day|date:'Y-m-d'}}&{{request|get_GET_day}}"  class="list-group-item list-group-item-action py-2 rounded-small {%if request.GET.date == day|date:'Y-m-d' %} active {%endif%}{%if forloop.counter == 1 and not request.GET.date %}active{%endif%}">{{day|date:'D'}}</a>
        {%endfor%}
    </ul>
</div>
<div class="d-flex justify-content-between align-items-end">
    <h2 class="mb-2">{{current_date|date:"M d, Y"}}</h2>
    <div class="d-flex gap-4">
        <p style="font-weight: 600;font-style: italic;">Total Net Profit</p>
        <p>{{total_profit.total | rounded}}</p>
    </div>
</div>
    <div class="container mb-3">
        <div class="row justify-content-end">
            <div class="col-xl-3 col-sm-3 col-6" id="TotalLamera">
                <div class="card shadow border-0">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col">
                                <span class="h6 font-semibold text-muted text-sm d-block mb-1">Total Lamera</span>
                                <span class="h3 font-bold mb-0 "><span> {{total_metals}} </span>
                            </div>
                        </div>
                    </div>
                     </div>
        </div>
        <div class="col-xl-3 col-sm-3 col-6" id="TotalLamera">
            <div class="card shadow border-0">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col">
                            <span class="h6 font-semibold text-muted text-sm d-block mb-1">Client N<span class="text-underline">o</span></span>
                            <span class="h3 font-bold mb-0 "><span> {{clients_count}} </span>
                        </div>
                    </div>
                </div>
                 </div>
    </div>
        </div>
    </div>
    <div class="container">
        <div class="row justify-content-around">
            <div class=" col-md-3">
                <p class="text-xl text-underline">Sheet metal List</p>
                <div>
                    {%for i in metals%}
                    <p class="d-flex justify-content-between">{{i.name |thickness_name}} <span style="background-color: white;width: 100px;" class="text-center rounded-md py-1 border-1 ">{{i.quantity.amm}} units</span></p>
                    {%endfor%}
                </div>
            </div>
            <div class="col-md-3">
                <p class="text-xl text-underline">Operational Cost</p>
                <div>
                    {%if  operational_cost%}
                    {%for i in operational_cost%}
                    <p class="d-flex justify-content-between">{{i.name}} <span style="background-color: white;width: 100px;" class="text-center rounded-md py-1 border-1 ">{{i.amm}}</span></p>
                    {%endfor%}
                    {%endif%}
                </div>
            </div>
            <div class="col-md-3">
                <p class="text-xl text-underline">client list</p>
                <div class="">
                    {%for i in clients%}
                    <p class="d-flex justify-content-between">{{i.name}} <span style="background-color: white;width: 100px;" class="text-center rounded-md py-1 border-1 ">{{i.debt}}</span></p>
                    {%endfor%}
                </div>
            </div>
        </div>
    </div>
    <div class="m-2">
        <table class="table table-sm table-striped table-bordered">
            <thead class="thead-light">
                <tr>
                    <th scope="col">ID <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Customer Name <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Thickness <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Price per Item <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Quantity <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Gross Revenue <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Gross Cost <i class="fa-solid fa-sort"></i></th>
                    <th scope="col">Operational Cost per unit <i class="fa-solid fa-sort"></i></th>

                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                <tr>
                    <th scope="row">{{ forloop.counter }}</th>
                    <td><a href="{% url 'invoice-detail' invoice.id %}">{{ invoice.item.client}}</a></td>
                    <td>{{ invoice.item.thickness }}</td>
                    <td>{{ invoice.unit_price }}</td>
                    <td>{{ invoice.quantity }}</td>
                    <td>{{ invoice.gross_revenue |rounded}}</td>
                    <td>{{ invoice.gross_cost| rounded }}</td>
                    <td>{{ invoice.opertional_cost| rounded }}</td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="mt-4">
        {% if is_paginated %}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{{request|get_GET}}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </span>
                </li>
                {% endif %}
                {% for i in paginator.page_range %}
                {% if page_obj.number == i %}
                <li class="page-item active" aria-current="page">
                    <span class="page-link">{{ i }} <span class="visually-hidden">(current)</span></span>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ i }}{{request|get_GET}}">{{ i }}</a>
                </li>
                {% endif %}
                {% endfor %}
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{{request|get_GET}}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock content %}
